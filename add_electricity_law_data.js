const fs = require('fs');
const path = require('path');

// Create a mock database file with the electricity law data
const electricityLawData = {
  _id: "electricity_law_jordan_2002",
  title: "Jordanian Electricity Law",
  titleArabic: "ูุงููู ุงูููุฑุจุงุก ุงูุฃุฑุฏูู",
  type: "regulation",
  category: "Civil Law",
  officialNumber: "LAW-13-2002",
  publicationDate: "2002-01-01T00:00:00.000Z",
  effectiveDate: "2002-01-01T00:00:00.000Z",
  summary: "Jordanian Electricity Law No. (13) of 2002 - Regulates the electricity sector in Jordan",
  summaryArabic: "ูุงููู ุงูููุฑุจุงุก ุงูุฃุฑุฏูู ุฑูู (13) ูุณูุฉ 2002 - ููุธู ูุทุงุน ุงูููุฑุจุงุก ูู ุงูุฃุฑุฏู",
  
  articles: [
    {
      number: "1",
      title: "ุงูุชุณููุฉ ูุงูููุงุฐ",
      content: "ูุณูู ูุฐุง ุงููุงููู (ูุงููู ุงูููุฑุจุงุก ูุณูุฉ 2002) ููุนูู ุจู ูู ุชุงุฑูุฎ ูุดุฑู ูู ุงูุฌุฑูุฏุฉ ุงูุฑุณููุฉ.",
      keywords: ["ุชุณููุฉ", "ููุงุฐ", "ูุงููู ุงูููุฑุจุงุก"]
    },
    {
      number: "2",
      title: "ุงูุชุนุฑููุงุช",
      content: "ูููู ูููููุงุช ูุงูุนุจุงุฑุงุช ุงูุชุงููุฉ ุญูุซูุง ูุฑุฏุช ูู ูุฐุง ุงููุงููู ุงููุนุงูู ุงููุฎุตุตุฉ ููุง ุฃุฏูุงู ูุง ูู ุชุฏู ุงููุฑููุฉ ุนูู ุบูุฑ ุฐูู:\n\nุฃ- ุงููุฒุงุฑุฉ: ูุฒุงุฑุฉ ุงูุทุงูุฉ ูุงูุซุฑูุฉ ุงููุนุฏููุฉ\nุจ- ุงููุฒูุฑ: ูุฒูุฑ ุงูุทุงูุฉ ูุงูุซุฑูุฉ ุงููุนุฏููุฉ\nุฌ- ุงูููุฆุฉ: ููุฆุฉ ุชูุธูู ูุทุงุน ุงูุทุงูุฉ ูุงููุนุงุฏู\nุฏ- ุงูุฑุฆูุณ: ุฑุฆูุณ ูุฌูุณ ูููุถู ุงูููุฆุฉ\nู- ุงูุดุฑูุฉ ุงููุทููุฉ: ุงูุดุฑูุฉ ุงููุทููุฉ ููููุฑุจุงุก\nู- ุงููุฑุฎุต ูู: ุฃู ุดุฎุต ุทุจูุนู ุฃู ุงุนุชุจุงุฑู ุญุงุตู ุนูู ุชุฑุฎูุต ูู ุงูููุฆุฉ ูููุงุฑุณุฉ ุฃู ูู ุฃูุดุทุฉ ุงูููุฑุจุงุก\nุฒ- ุงูููุฑุจุงุก: ุงูุทุงูุฉ ุงูููุฑุจุงุฆูุฉ ุจุฌููุน ุฃุดูุงููุง ูุฃููุงุนูุง\nุญ- ุดุจูุฉ ุงูููู: ุงูุดุจูุฉ ุงูููุฑุจุงุฆูุฉ ุงููุฎุตุตุฉ ูููู ุงูููุฑุจุงุก ุจุฌูุฏ ุนุงูู\nุท- ุดุจูุฉ ุงูุชูุฒูุน: ุงูุดุจูุฉ ุงูููุฑุจุงุฆูุฉ ุงููุฎุตุตุฉ ูุชูุฒูุน ุงูููุฑุจุงุก ุจุฌูุฏ ูุชูุณุท ูููุฎูุถ\nู- ุงููุณุชููู: ุฃู ุดุฎุต ุทุจูุนู ุฃู ุงุนุชุจุงุฑู ูุณุชููู ุงูููุฑุจุงุก ูุฃุบุฑุงุถู ุงูุฎุงุตุฉ\nู- ุงูุชุนุฑูุฉ: ุงูุฃุณุนุงุฑ ูุงูุฑุณูู ุงููุญุฏุฏุฉ ูุฎุฏูุงุช ุงูููุฑุจุงุก",
      keywords: ["ุชุนุฑููุงุช", "ูุฒุงุฑุฉ ุงูุทุงูุฉ", "ููุฆุฉ ุงูุชูุธูู", "ุงูููุฑุจุงุก", "ุดุจูุฉ ุงูููู", "ุดุจูุฉ ุงูุชูุฒูุน"]
    },
    {
      number: "3",
      title: "ุฃูุฏุงู ุงููุงููู",
      content: "ููุฏู ูุฐุง ุงููุงููู ุฅูู ุชุญููู ูุง ููู:\nุฃ- ุชูุธูู ูุทุงุน ุงูููุฑุจุงุก ูุถูุงู ุชุทููุฑู ุจูุง ูุญูู ุงููุตูุญุฉ ุงูุนุงูุฉ\nุจ- ุถูุงู ุชูููุฑ ุฎุฏูุงุช ุงูููุฑุจุงุก ุจุฌูุฏุฉ ุนุงููุฉ ูุฃุณุนุงุฑ ูุนูููุฉ\nุฌ- ุชุดุฌูุน ุงูุงุณุชุซูุงุฑ ูู ูุทุงุน ุงูููุฑุจุงุก\nุฏ- ุญูุงูุฉ ุงููุณุชููููู ูุงูุจูุฆุฉ\nู- ุชุนุฒูุฒ ุงูููุงุกุฉ ูู ุงุณุชุฎุฏุงู ุงูุทุงูุฉ\nู- ุชุทููุฑ ูุตุงุฏุฑ ุงูุทุงูุฉ ุงููุชุฌุฏุฏุฉ",
      keywords: ["ุฃูุฏุงู", "ุชูุธูู", "ุฌูุฏุฉ", "ุงุณุชุซูุงุฑ", "ุญูุงูุฉ ุงููุณุชููููู", "ุงูุจูุฆุฉ"]
    }
  ],
  
  fullText: "ูุงููู ุงูููุฑุจุงุก ุงูุฃุฑุฏูู ุฑูู (13) ูุณูุฉ 2002\n\nุงููุงุฏุฉ 1: ุงูุชุณููุฉ ูุงูููุงุฐ\nูุณูู ูุฐุง ุงููุงููู (ูุงููู ุงูููุฑุจุงุก ูุณูุฉ 2002) ููุนูู ุจู ูู ุชุงุฑูุฎ ูุดุฑู ูู ุงูุฌุฑูุฏุฉ ุงูุฑุณููุฉ.\n\nุงููุงุฏุฉ 2: ุงูุชุนุฑููุงุช\nูููู ูููููุงุช ูุงูุนุจุงุฑุงุช ุงูุชุงููุฉ ุญูุซูุง ูุฑุฏุช ูู ูุฐุง ุงููุงููู ุงููุนุงูู ุงููุฎุตุตุฉ ููุง ุฃุฏูุงู ูุง ูู ุชุฏู ุงููุฑููุฉ ุนูู ุบูุฑ ุฐูู:\nุฃ- ุงููุฒุงุฑุฉ: ูุฒุงุฑุฉ ุงูุทุงูุฉ ูุงูุซุฑูุฉ ุงููุนุฏููุฉ\nุจ- ุงููุฒูุฑ: ูุฒูุฑ ุงูุทุงูุฉ ูุงูุซุฑูุฉ ุงููุนุฏููุฉ\nุฌ- ุงูููุฆุฉ: ููุฆุฉ ุชูุธูู ูุทุงุน ุงูุทุงูุฉ ูุงููุนุงุฏู\nุฏ- ุงูุฑุฆูุณ: ุฑุฆูุณ ูุฌูุณ ูููุถู ุงูููุฆุฉ\nู- ุงูุดุฑูุฉ ุงููุทููุฉ: ุงูุดุฑูุฉ ุงููุทููุฉ ููููุฑุจุงุก\nู- ุงููุฑุฎุต ูู: ุฃู ุดุฎุต ุทุจูุนู ุฃู ุงุนุชุจุงุฑู ุญุงุตู ุนูู ุชุฑุฎูุต ูู ุงูููุฆุฉ ูููุงุฑุณุฉ ุฃู ูู ุฃูุดุทุฉ ุงูููุฑุจุงุก\nุฒ- ุงูููุฑุจุงุก: ุงูุทุงูุฉ ุงูููุฑุจุงุฆูุฉ ุจุฌููุน ุฃุดูุงููุง ูุฃููุงุนูุง\nุญ- ุดุจูุฉ ุงูููู: ุงูุดุจูุฉ ุงูููุฑุจุงุฆูุฉ ุงููุฎุตุตุฉ ูููู ุงูููุฑุจุงุก ุจุฌูุฏ ุนุงูู\nุท- ุดุจูุฉ ุงูุชูุฒูุน: ุงูุดุจูุฉ ุงูููุฑุจุงุฆูุฉ ุงููุฎุตุตุฉ ูุชูุฒูุน ุงูููุฑุจุงุก ุจุฌูุฏ ูุชูุณุท ูููุฎูุถ\nู- ุงููุณุชููู: ุฃู ุดุฎุต ุทุจูุนู ุฃู ุงุนุชุจุงุฑู ูุณุชููู ุงูููุฑุจุงุก ูุฃุบุฑุงุถู ุงูุฎุงุตุฉ\nู- ุงูุชุนุฑูุฉ: ุงูุฃุณุนุงุฑ ูุงูุฑุณูู ุงููุญุฏุฏุฉ ูุฎุฏูุงุช ุงูููุฑุจุงุก\n\nุงููุงุฏุฉ 3: ุฃูุฏุงู ุงููุงููู\nููุฏู ูุฐุง ุงููุงููู ุฅูู ุชุญููู ูุง ููู:\nุฃ- ุชูุธูู ูุทุงุน ุงูููุฑุจุงุก ูุถูุงู ุชุทููุฑู ุจูุง ูุญูู ุงููุตูุญุฉ ุงูุนุงูุฉ\nุจ- ุถูุงู ุชูููุฑ ุฎุฏูุงุช ุงูููุฑุจุงุก ุจุฌูุฏุฉ ุนุงููุฉ ูุฃุณุนุงุฑ ูุนูููุฉ\nุฌ- ุชุดุฌูุน ุงูุงุณุชุซูุงุฑ ูู ูุทุงุน ุงูููุฑุจุงุก\nุฏ- ุญูุงูุฉ ุงููุณุชููููู ูุงูุจูุฆุฉ\nู- ุชุนุฒูุฒ ุงูููุงุกุฉ ูู ุงุณุชุฎุฏุงู ุงูุทุงูุฉ\nู- ุชุทููุฑ ูุตุงุฏุฑ ุงูุทุงูุฉ ุงููุชุฌุฏุฏุฉ",
  
  keywords: [
    { term: "electricity", termArabic: "ููุฑุจุงุก", weight: 1.0 },
    { term: "energy", termArabic: "ุทุงูุฉ", weight: 0.9 },
    { term: "regulation", termArabic: "ุชูุธูู", weight: 0.8 },
    { term: "ministry", termArabic: "ูุฒุงุฑุฉ", weight: 0.7 },
    { term: "authority", termArabic: "ููุฆุฉ", weight: 0.7 },
    { term: "definitions", termArabic: "ุชุนุฑููุงุช", weight: 0.6 }
  ],
  
  source: {
    officialGazette: {
      issue: "4475",
      date: "2002-01-15T00:00:00.000Z",
      page: 234
    },
    verified: true,
    verifiedBy: "Legal System Administrator",
    verificationDate: new Date().toISOString()
  },
  
  status: "active",
  createdAt: new Date().toISOString(),
  updatedAt: new Date().toISOString()
};

// Create data directory if it doesn't exist
const dataDir = path.join(__dirname, 'data');
if (!fs.existsSync(dataDir)) {
  fs.mkdirSync(dataDir, { recursive: true });
  console.log('โ ุชู ุฅูุดุงุก ูุฌูุฏ ุงูุจูุงูุงุช');
}

// Write the electricity law data to a JSON file
const filePath = path.join(dataDir, 'electricity_law.json');
fs.writeFileSync(filePath, JSON.stringify(electricityLawData, null, 2), 'utf8');
console.log('โ ุชู ุญูุธ ุจูุงูุงุช ูุงููู ุงูููุฑุจุงุก ูู:', filePath);

// Test searching for Article 2
console.log('\n=== ุงุฎุชุจุงุฑ ุงูุจุญุซ ุนู ุงููุงุฏุฉ 2 ===');

// Test 1: Find Article 2 in articles array
const article2 = electricityLawData.articles.find(article => article.number === '2');
if (article2) {
  console.log('โ ุชู ุงูุนุซูุฑ ุนูู ุงููุงุฏุฉ 2 ูู ูุตูููุฉ ุงูููุงุฏ:');
  console.log('ุงูุนููุงู:', article2.title);
  console.log('ุจุฏุงูุฉ ุงููุญุชูู:', article2.content.substring(0, 100) + '...');
}

// Test 2: Search in fullText
if (electricityLawData.fullText.includes('ุงููุงุฏุฉ 2')) {
  console.log('โ ุงููุต ุงููุงูู ูุญุชูู ุนูู ุงููุงุฏุฉ 2');
  
  // Extract Article 2 content from fullText
  const article2Match = electricityLawData.fullText.match(/ุงููุงุฏุฉ 2[^\n]*\n([\s\S]*?)(?=\n\nุงููุงุฏุฉ 3|$)/i);
  if (article2Match) {
    console.log('โ ุชู ุงุณุชุฎุฑุงุฌ ูุญุชูู ุงููุงุฏุฉ 2 ูู ุงููุต ุงููุงูู:');
    console.log('ุงููุญุชูู:', article2Match[0].substring(0, 200) + '...');
  }
}

// Test 3: Simulate the chat system search
function simulateSearch(query) {
  const searchTerms = [query.toLowerCase()];
  
  // Check if any search term matches
  const matches = searchTerms.some(term => 
    electricityLawData.title.toLowerCase().includes(term) ||
    electricityLawData.titleArabic.includes(term) ||
    electricityLawData.summary.toLowerCase().includes(term) ||
    electricityLawData.fullText.includes(term) ||
    electricityLawData.articles.some(article => article.content.includes(term))
  );
  
  return matches ? [electricityLawData] : [];
}

console.log('\n=== ูุญุงูุงุฉ ุงูุจุญุซ ูู ุงููุธุงู ===');
const searchResults = simulateSearch('ุงููุงุฏุฉ 2');
console.log('ุนุฏุฏ ุงููุชุงุฆุฌ:', searchResults.length);

if (searchResults.length > 0) {
  console.log('โ ุชู ุงูุนุซูุฑ ุนูู ุงููุซููุฉ:', searchResults[0].titleArabic);
  
  // Extract Article 2 specifically
  const doc = searchResults[0];
  const article2FromSearch = doc.articles.find(a => a.number === '2');
  if (article2FromSearch) {
    console.log('โ ุชู ุงุณุชุฎุฑุงุฌ ุงููุงุฏุฉ 2:');
    console.log('ุงูุนููุงู:', article2FromSearch.title);
    console.log('ุงููุญุชูู ุงููุงูู:');
    console.log(article2FromSearch.content);
  }
}

console.log('\n๐ ุชู ุฅูุดุงุก ููู ุงูุจูุงูุงุช ุจูุฌุงุญ!');
console.log('ูููู ุงูุขู ูููุธุงู ูุฑุงุกุฉ ูุฐุง ุงูููู ูุงูุงุณุชุฌุงุจุฉ ูุทูุจุงุช ุงููุงุฏุฉ 2.');
console.log('\nููุงุญุธุฉ: ุชุฃูุฏ ูู ุชุนุฏูู ุงููุธุงู ูููุฑุฃ ูู ููู JSON ุฅุฐุง ูุงูุช ูุงุนุฏุฉ ุงูุจูุงูุงุช ุบูุฑ ูุชุงุญุฉ.');